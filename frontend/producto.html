<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestión de Productos</title>
  <link rel="shortcut icon" href="../img/imagen.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body, html { margin: 0; padding: 0; height: 100%; }
    header { height: 60px; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; }
    .main-layout { display: flex; height: calc(100vh - 60px); }
    .sidebar { width: 60px; background-color: #198754; color: white; transition: width 0.3s; overflow-x: hidden; display: flex; flex-direction: column; }
    .sidebar:hover { width: 250px; }
    .sidebar a { color: white; text-decoration: none; padding: 15px 20px; display: flex; align-items: center; white-space: nowrap; }
    .sidebar a:hover { background-color: #495057; }
    .sidebar i { margin-right: 10px; min-width: 20px; text-align: center; }
    .sidebar span { opacity: 0; transition: opacity 0.3s ease; }
    .sidebar:hover span { opacity: 1; }
    header img { height: 40px; margin-right: 10px; }
    .content { flex-grow: 1; padding: 20px; overflow-y: auto; background-color: #f5f5f5; }
    h1, h2 { color: #2c3e50; }
    form, table { background-color: #fff; padding: 15px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, select { margin-bottom: 10px; padding: 8px; width: 100%; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 10px; text-align: left; }
    button { padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #5daf78; }
  </style>
</head>
<body>

<header>
  <img src="../img/imagen.png" alt="logo de abaco">
  <h5 class="mb-0">Sistema de Inventario y Donaciones, <strong>DIOCESIS</strong></h5>
  <div>
    <i class="bi bi-person-circle"></i>
    <span class="me-3"> <strong>Karina</strong> </span>
    <i class="bi bi-bell-fill me-3"></i>
  </div>
</header>

<div class="main-layout">
  <div class="sidebar">
    <a href="menu_central.html"><i class="bi bi-house-door-fill"></i><span>Inicio</span></a>
    <a href="movimiento_inv.html"><i class="bi bi-box-seam"></i><span>Inventario</span></a>
    <a href="donaciones.html"><i class="bi bi-heart-fill"></i><span>Donaciones</span></a>
    <a href="permisos.html"><i class="bi bi-people-fill"></i><span>Voluntarios</span></a>
    <a href="RGT_producto.html"><i class="bi bi-graph-up"></i><span>Reportes</span></a>
    <a href="#" class="mt-auto"><i class="bi bi-gear-fill"></i><span>Configuración</span></a>
  </div>

  <div class="content">
    <h1>Registrar Nuevo Producto</h1>

    <form id="formProducto">
      <select id="categoriaSelect" required>
        <option value="">Selecciona una categoría</option>
      </select>
      <select id="subcategoriaSelect" required disabled>
        <option value="">Selecciona una subcategoría</option>
      </select>
      <select id="productoSelect" required disabled>
        <option value="">Seleccione el producto</option>
      </select>
      <input type="number" id="precioProducto" placeholder="Precio" min="0" step="0.01" required />
      <input type="number" id="cantidadProducto" placeholder="Cantidad" min="1" step="1" required />
      <input type="text" id="pesoUnitario" placeholder="Peso Unitario" required />
      <input type="date" id="fechaVencimiento" placeholder="Fecha de Vencimiento" required />
      <input type="text" id="descripcionProducto" placeholder="Descripción del producto" />
      <button type="submit">Guardar Producto</button>
    </form>

    <h2>Lista de Productos</h2>
    <table id="tablaProductos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Cantidad</th>
          <th>Categoría</th>
          <th>Subcategoría</th>
          <th>Peso Unitario</th>
          <th>Fecha Vencimiento</th>
          <th>Descripción</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
// Datos
const categorias = [
  { id: 1, nombre: "Alimentos" },
  { id: 2, nombre: "Limpieza" },
  { id: 3, nombre: "Tecnología" }
];

const subcategorias = [
  { id: 1, categoriaId: 1, nombre: "Frutas" },
  { id: 2, categoriaId: 1, nombre: "Verduras" },
  { id: 3, categoriaId: 2, nombre: "Detergentes" },
  { id: 4, categoriaId: 3, nombre: "Computadoras" },
  { id: 5, categoriaId: 3, nombre: "Celulares" }
];

const productos = [
  { id: 1, subcategoriaId: 1, nombre: "Manzana" },
  { id: 2, subcategoriaId: 1, nombre: "Banana" },
  { id: 3, subcategoriaId: 2, nombre: "Lechuga" },
  { id: 4, subcategoriaId: 4, nombre: "Laptop" },
  { id: 5, subcategoriaId: 5, nombre: "iPhone" }
];

// Elementos
const formProducto = document.getElementById('formProducto');
const categoriaSelect = document.getElementById('categoriaSelect');
const subcategoriaSelect = document.getElementById('subcategoriaSelect'); 
const productoSelect = document.getElementById('productoSelect'); 
const tablaProductos = document.getElementById('tablaProductos').querySelector('tbody');
const inputPesoUnitario = document.getElementById('pesoUnitario');
const inputFechavencimiento = document.getElementById('fechaVencimiento');

let idProducto = 1;
let editandoProducto = null;

// Cargar categorías
function cargarCategorias() {
  categorias.forEach(cat => {
    const option = document.createElement('option');
    option.value = cat.id;
    option.textContent = cat.nombre;
    categoriaSelect.appendChild(option);
  });
}
cargarCategorias();

// Subcategorías dinámicas
function cargarSubcategorias(categoriaId) {
  subcategoriaSelect.innerHTML = '<option value="">Selecciona una subcategoría</option>';
  productoSelect.innerHTML = '<option value="">Seleccione el producto</option>';
  productoSelect.disabled = true;
  if (!categoriaId) {
    subcategoriaSelect.disabled = true;
    return;
  }
  const filtradas = subcategorias.filter(sub => sub.categoriaId == categoriaId);
  filtradas.forEach(sub => {
    const option = document.createElement('option');
    option.value = sub.id;
    option.textContent = sub.nombre;
    subcategoriaSelect.appendChild(option);
  });
  subcategoriaSelect.disabled = false;
}

categoriaSelect.addEventListener('change', function () {
  cargarSubcategorias(this.value);
});

// Productos dinámicos
function cargarProductos(subcategoriaId) {
  productoSelect.innerHTML = '<option value="">Seleccione el producto</option>';
  if (!subcategoriaId) {
    productoSelect.disabled = true;
    return;
  }
  const filtrados = productos.filter(p => p.subcategoriaId == subcategoriaId);
  filtrados.forEach(p => {
    const option = document.createElement('option');
    option.value = p.id;
    option.textContent = p.nombre;
    productoSelect.appendChild(option);
  });
  productoSelect.disabled = false;
}

subcategoriaSelect.addEventListener('change', function() {
  cargarProductos(this.value);
});

// Guardar producto
formProducto.addEventListener('submit', function (e) {
  e.preventDefault();

  const categoriaId = categoriaSelect.value;
  const subcategoriaId = subcategoriaSelect.value;
  const productoId = productoSelect.value;
  const nombre = productoSelect.options[productoSelect.selectedIndex].text;
  const precio = parseFloat(document.getElementById('precioProducto').value);
  const cantidad = parseInt(document.getElementById('cantidadProducto').value);
  const descripcion = document.getElementById('descripcionProducto').value.trim();
  const pesoUnitario = inputPesoUnitario.value.trim();
  const fechaVencimiento = inputFechavencimiento.value;

  // Validación
  if (!categoriaId || !subcategoriaId || !productoId || !nombre || isNaN(precio) || isNaN(cantidad) || cantidad < 1 || !pesoUnitario || !fechaVencimiento) {
    alert("⚠ Por favor, completa todos los campos correctamente.");
    return;
  }

  const categoriaNombre = categorias.find(c => c.id == categoriaId)?.nombre || '';
  const subcategoriaNombre = subcategorias.find(s => s.id == subcategoriaId)?.nombre || '';

  if (editandoProducto) {
    editandoProducto.querySelector('.col-nombre').textContent = nombre;
    editandoProducto.querySelector('.col-precio').textContent = precio.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
    editandoProducto.querySelector('.col-cantidad').textContent = cantidad;
    editandoProducto.querySelector('.col-categoria').textContent = categoriaNombre;
    editandoProducto.querySelector('.col-subcategoria').textContent = subcategoriaNombre;
    editandoProducto.querySelector('.col-peso-unitario').textContent = pesoUnitario;
    editandoProducto.querySelector('.col-fecha-vencimiento').textContent = fechaVencimiento;
    editandoProducto.querySelector('.col-descripcion').textContent = descripcion;
    editandoProducto = null;
  } else {
    const fila = document.createElement('tr');
    fila.innerHTML = `
      <td>${idProducto++}</td>
      <td class="col-nombre">${nombre}</td>
      <td class="col-precio">${precio.toLocaleString('es-CO', { style: 'currency', currency: 'COP' })}</td>
      <td class="col-cantidad">${cantidad}</td>
      <td class="col-categoria">${categoriaNombre}</td>
      <td class="col-subcategoria">${subcategoriaNombre}</td>
      <td class="col-peso-unitario">${pesoUnitario}</td>
      <td class="col-fecha-vencimiento">${fechaVencimiento}</td>
      <td class="col-descripcion">${descripcion}</td>
      <td>
        <button onclick="editarProducto(this)">Editar</button>
        <button onclick="eliminarProducto(this)" style="background-color:red">Eliminar</button>
      </td>
    `;
    tablaProductos.appendChild(fila);
  }

  formProducto.reset();
  subcategoriaSelect.disabled = true;
  productoSelect.disabled = true;
});

// Editar producto
function editarProducto(btn) {
  const fila = btn.closest('tr');
  editandoProducto = fila;

  const nombreTexto = fila.querySelector('.col-nombre').textContent;
  const descripcion = fila.querySelector('.col-descripcion').textContent;
  const precioTexto = fila.querySelector('.col-precio').textContent.replace(/[^\d,]/g, '').replace(',', '.');
  const cantidad = fila.querySelector('.col-cantidad').textContent;
  const peso = fila.querySelector('.col-peso-unitario').textContent;
  const fecha = fila.querySelector('.col-fecha-vencimiento').textContent;
  const categoriaNombre = fila.querySelector('.col-categoria').textContent;
  const subcategoriaNombre = fila.querySelector('.col-subcategoria').textContent;

  const categoria = categorias.find(c => c.nombre === categoriaNombre);
  if (categoria) {
    categoriaSelect.value = categoria.id;
    cargarSubcategorias(categoria.id);
    const subcategoria = subcategorias.find(s => s.nombre === subcategoriaNombre && s.categoriaId == categoria.id);
    if (subcategoria) {
      subcategoriaSelect.value = subcategoria.id;
      cargarProductos(subcategoria.id);
      const producto = productos.find(p => p.nombre === nombreTexto && p.subcategoriaId == subcategoria.id);
      if (producto) productoSelect.value = producto.id;
    }
  }

  document.getElementById('precioProducto').value = parseFloat(precioTexto);
  document.getElementById('cantidadProducto').value = cantidad;
  inputPesoUnitario.value = peso;
  inputFechavencimiento.value = fecha;
  document.getElementById('descripcionProducto').value = descripcion;
}

// Eliminar producto
function eliminarProducto(btn) {
  if (confirm("⚠ ¿Estás seguro que quieres eliminar este producto?")) {
    btn.closest('tr').remove();
    alert("🗑 Producto eliminado exitosamente.");
  }
}
</script>
</body>
</html>
