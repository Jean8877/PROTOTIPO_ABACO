<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gesti√≥n de Usuarios - Di√≥cesis</title>
    <link rel="shortcut icon" href="../imagenes/imagen.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        /* HEADER */
        header {
            height: 60px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header img {
            height: 40px;
            margin-right: 10px;
        }

        /* LAYOUT GENERAL */
        .main-layout {
            display: flex;
            height: calc(100vh - 60px);
            /* Resta el alto del header */
        }

        /* SIDEBAR */
        .sidebar {
            width: 60px;
            background-color: #198754;
            color: white;
            transition: width 0.3s;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .sidebar:hover {
            width: 250px;
        }

        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .sidebar a:hover {
            background-color: #495057;
        }

        .sidebar i {
            margin-right: 10px;
            min-width: 20px;
            text-align: center;
        }

        .sidebar span {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover span {
            opacity: 1;
        }

        /* CONTENIDO */
        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f5f6fa;
        }

        /* Estilo acorde√≥n */
        .accordion-button {
            font-weight: bold;
            font-size: 1rem;
            background: linear-gradient(90deg, #198754, #418666);
            color: #fff;
            border-radius: 12px;
        }

        .accordion-button:not(.collapsed) {
            color: #fff;
            background: linear-gradient(90deg, #198754, #418666);
        }

        .accordion-item {
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
            border: none;
        }

        /* Tarjetas de usuarios */
        .user-card {
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background: #fff;
            padding: 15px;
            margin-bottom: 10px;
        }

        .user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        /* Botones */
        .btn-custom {
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 14px;
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <header>
        <img src="../imagenes/image.png" alt="logo de abaco">
        <h5 class="mb-0">Sistema de Inventario y Donaciones, <strong>DIOCESIS</strong></h5>
        <div>
            <i class="bi bi-person-circle"></i>
            <span class="me-3"> <strong>Karina</strong> </span>
      <i class="bi bi-bell-fill me-3" style="cursor: pointer;" onclick="swal('Notificaciones')"></i>
        </div>
    </header>

    <!-- LAYOUT: SIDEBAR + CONTENT -->
    <div class="main-layout">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <a href="menu_central.html"><i class="bi bi-house-door-fill"></i><span>Inicio</span></a>
            <a href="movimiento_inv.html"><i class="bi bi-box-seam"></i> <span>Inventario</span></a>
            <a href="pagina_principal.html"><i class="bi bi-heart-fill"></i> <span>Donaciones</span></a>
            <a href="permisos_asistentes.html"><i class="bi bi-people-fill"></i> <span>Voluntarios</span></a>
            <a href="menu_reportes.html"><i class="bi bi-graph-up"></i> <span>Reportes</span></a>
            <a href="pag_confi.html" class="mt-auto"><i class="bi bi-gear-fill"></i><span>Configuraci√≥n</span></a>
        </div>

        <!-- CONTENIDO -->
        <div class="content">
            <div class="container bg-white p-4 rounded shadow">
                <div class="row justify-content-center">
                    <div class="col-12 col-lg-10">
                        <h2 class="mb-4 text-center">üë§ Gesti√≥n de Usuarios</h2>

                        <div class="accordion" id="accordionUsuarios">
                            <!-- Usuarios Registrados -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingOne">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        üë• Usuarios Registrados
                                    </button>
                                </h2>
                                <div id="collapseOne" class="accordion-collapse collapse show"
                                    aria-labelledby="headingOne" data-bs-parent="#accordionUsuarios">
                                    <div class="accordion-body">
                                        <div id="listaUsuarios" class="row g-4"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Registrar Usuario -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingTwo">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        ‚ûï Registrar Usuario
                                    </button>
                                </h2>
                                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                                    data-bs-parent="#accordionUsuarios">
                                    <div class="accordion-body">
                                        <form id="formUsuario">
                                            <div class="mb-3">
                                                <label for="nombreUsuario" class="form-label">Nombre completo</label>
                                                <input type="text" id="nombreUsuario" class="form-control" required>
                                            </div>

                                            <div class="mb-3">
                                                <label for="username" class="form-label">Usuario</label>
                                                <input type="text" id="username" class="form-control" required>
                                            </div>

                                            <div class="mb-3">
                                                <label for="correo" class="form-label">Correo electr√≥nico</label>
                                                <input type="email" id="correo" class="form-control">
                                            </div>

                                            <div class="mb-3">
                                                <label for="password" class="form-label">Contrase√±a</label>
                                                <input type="password" id="password" class="form-control" required>
                                            </div>

                                            <div class="mb-3">
                                                <label for="confirmPassword" class="form-label">Confirmar
                                                    Contrase√±a</label>
                                                <input type="password" id="confirmPassword" class="form-control"
                                                    required>
                                            </div>

                                            <div class="mb-3">
                                                <label for="rol" class="form-label">Rol de usuario</label>
                                                <select id="rol" class="form-select">
                                                    <option value="admin">Administrador</option>
                                                    <option value="asistente">Asistente</option>
                                                    <option value="voluntario">Voluntario</option>
                                                </select>
                                            </div>

                                            <div class="d-flex justify-content-between">
                                                <button type="submit" class="btn btn-success btn-custom">Guardar
                                                    Usuario</button>
                                                <button type="reset"
                                                    class="btn btn-secondary btn-custom">Limpiar</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script>
            const form = document.getElementById('formUsuario');
            const listaUsuarios = document.getElementById('listaUsuarios');

            function obtenerUsuarios() {
                return JSON.parse(localStorage.getItem("usuariosConfig")) || [];
            }

            function guardarUsuarios(usuarios) {
                localStorage.setItem("usuariosConfig", JSON.stringify(usuarios));
            }

            function mostrarUsuarios() {
                listaUsuarios.innerHTML = "";
                const usuarios = obtenerUsuarios();

                if (usuarios.length === 0) {
                    listaUsuarios.innerHTML = "<p class='text-center text-muted'>No hay usuarios registrados.</p>";
                    return;
                }

                usuarios.forEach((u, index) => {
                    const col = document.createElement("div");
                    col.className = "col-12 col-md-6 col-lg-4";
                    col.innerHTML = `
          <div class="user-card h-100">
            <h5 class="text-primary">${u.nombre}</h5>
            <p class="mb-1"><strong>Usuario:</strong> ${u.username}</p>
            <p class="mb-1"><strong>Rol:</strong> ${u.rol}</p>
            <p><strong>Correo:</strong> ${u.correo || "No registrado"}</p>
            <div class="d-flex justify-content-between">
              <button class="btn btn-warning btn-sm" onclick="editarUsuario(${index})">‚úèÔ∏è Editar</button>
              <button class="btn btn-danger btn-sm" onclick="eliminarUsuario(${index})">üóë Eliminar</button>
            </div>
          </div>
        `;
                    listaUsuarios.appendChild(col);
                });
            }

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const nombre = document.getElementById('nombreUsuario').value;
                const username = document.getElementById('username').value;
                const correo = document.getElementById('correo').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const rol = document.getElementById('rol').value;

                if (password !== confirmPassword) {
                    swal("Advertencia", "Las contrase√±as no coinciden", "warning");
                    
                    return;
                }

                
                let usuarios = obtenerUsuarios();
                usuarios.push({ nombre, username, correo, password, rol });
                guardarUsuarios(usuarios);
                mostrarUsuarios();
                form.reset();
                swal("Mensaje", "Usuario guardado correctamente.", "success");
            });
            
            
            function editarUsuario(index) {
                const usuarios = obtenerUsuarios();
                const u = usuarios[index];
                
                document.getElementById('nombreUsuario').value = u.nombre;
                document.getElementById('username').value = u.username;
                document.getElementById('correo').value = u.correo;
                document.getElementById('password').value = u.password;
                document.getElementById('confirmPassword').value = u.password;
                document.getElementById('rol').value = u.rol;
                
                usuarios.splice(index, 1);
                guardarUsuarios(usuarios);
                mostrarUsuarios();
                
                let collapseTwo = new bootstrap.Collapse(document.getElementById('collapseTwo'), { toggle: true });
            }

            function eliminarUsuario(index) {
                let usuarios = obtenerUsuarios();
                usuarios.splice(index, 1);
                guardarUsuarios(usuarios);
                mostrarUsuarios();
                swal("Mensaje", "Usuario eliminado correctamente.", "warning");
            }

            window.addEventListener("load", mostrarUsuarios);
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>